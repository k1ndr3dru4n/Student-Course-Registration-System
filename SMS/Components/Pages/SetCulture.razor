@page "/set-culture"
@using Microsoft.AspNetCore.Localization
@using System.Globalization
@using Microsoft.AspNetCore.WebUtilities
@inject NavigationManager Navigation

@code {
    protected override void OnInitialized()
    {
        var uri = new Uri(Navigation.Uri);
        var queryDict = QueryHelpers.ParseQuery(uri.Query);
        
        var culture = queryDict.TryGetValue("culture", out var cultureValue) ? cultureValue.ToString() : "";
        var returnUrl = queryDict.TryGetValue("returnUrl", out var returnValue) ? returnValue.ToString() : "/";
        
        if (!string.IsNullOrEmpty(culture))
        {
            // 直接重定向到带有culture参数的目标URL
            var separator = returnUrl.Contains("?") ? "&" : "?";
            var targetUrl = $"{returnUrl}{separator}culture={culture}";
            Navigation.NavigateTo(targetUrl, forceLoad: true);
        }
        else
        {
            Navigation.NavigateTo(returnUrl, forceLoad: true);
        }
    }
}
