@page "/debug-auth"
@inject IJSRuntime JSRuntime
@rendermode InteractiveServer

<h2>Debug Authentication Information</h2>

<div style="background: #f5f5f5; padding: 20px; margin: 20px 0; border-radius: 8px;">
    <h4>LocalStorage Contents:</h4>
    @if (isLoaded)
    {
        <ul>
            <li><strong>userRole:</strong> '@userRole' (Type: @(userRole?.GetType().Name ?? "null"))</li>
            <li><strong>userName:</strong> '@userName' (Type: @(userName?.GetType().Name ?? "null"))</li>
            <li><strong>userId:</strong> '@userId' (Type: @(userId?.GetType().Name ?? "null"))</li>
        </ul>
        
        <h4>Validation Results:</h4>
        <ul>
            <li><strong>userRole == "2":</strong> @(userRole == "2")</li>
            <li><strong>!string.IsNullOrEmpty(userName):</strong> @(!string.IsNullOrEmpty(userName))</li>
            <li><strong>Can access admin-home:</strong> @(userRole == "2" && !string.IsNullOrEmpty(userName))</li>
        </ul>
        
        <h4>Raw localStorage Debug:</h4>
        <div style="background: #fff; padding: 10px; border: 1px solid #ddd; font-family: monospace; font-size: 12px;">
            @rawLocalStorageData
        </div>
    }
    else
    {
        <p>Loading...</p>
    }
</div>

<div style="margin: 20px 0;">
    <button class="btn btn-primary" @onclick="RefreshData">Refresh Data</button>
    <button class="btn btn-danger" @onclick="ClearLocalStorage">Clear LocalStorage</button>
</div>

<div style="margin: 20px 0;">
    <a href="/admin-home" class="btn btn-info">Test Admin Home Access</a>
    <a href="/login" class="btn btn-secondary">Go to Login</a>
</div>

@code {
    private bool isLoaded = false;
    private string? userRole;
    private string? userName;
    private string? userId;
    private string rawLocalStorageData = "";

    protected override async Task OnInitializedAsync()
    {
        await LoadAuthData();
    }

    private async Task LoadAuthData()
    {
        try
        {
            userRole = await JSRuntime.InvokeAsync<string>("localStorage.getItem", "userRole");
            userName = await JSRuntime.InvokeAsync<string>("localStorage.getItem", "userName");
            userId = await JSRuntime.InvokeAsync<string>("localStorage.getItem", "userId");
            
            // Get all localStorage data for debugging
            rawLocalStorageData = await JSRuntime.InvokeAsync<string>("getAllLocalStorageData");
            
            isLoaded = true;
            StateHasChanged();
        }
        catch (Exception ex)
        {
            rawLocalStorageData = $"Error loading data: {ex.Message}";
            isLoaded = true;
            StateHasChanged();
        }
    }

    private async Task RefreshData()
    {
        isLoaded = false;
        StateHasChanged();
        await LoadAuthData();
    }

    private async Task ClearLocalStorage()
    {
        await JSRuntime.InvokeVoidAsync("localStorage.clear");
        await RefreshData();
    }
}

<script>
window.getAllLocalStorageData = function() {
    var data = {};
    for (var i = 0; i < localStorage.length; i++) {
        var key = localStorage.key(i);
        data[key] = localStorage.getItem(key);
    }
    return JSON.stringify(data, null, 2);
};
</script>

<style>
.btn {
    padding: 8px 16px;
    margin: 4px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    text-decoration: none;
    display: inline-block;
}
.btn-primary { background: #007bff; color: white; }
.btn-danger { background: #dc3545; color: white; }
.btn-info { background: #17a2b8; color: white; }
.btn-secondary { background: #6c757d; color: white; }
</style>
